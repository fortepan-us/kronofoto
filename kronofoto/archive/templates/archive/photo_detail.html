{% extends base_template %}
{% load static %}
{% load timeline %}
{% load thumbnails %}
{% load cache %}
{% load photometadata %}
{% load widgets %}

{% block viewbuttons %}
{% include "archive/view-buttons.html" with timelineclass="current-view" %}
{% endblock %}
{% block content %}
<main hx-target="#fi-image" hx-swap="outerHTML" hx-select="#fi-image" hx-select-oob="timeline-container,grid-icon,navigation-menu,fi-timeline,collection-name,all-photos,active-year-marker">

    <div class="img-left-space"></div>
    <div class="fi-image-background"></div>

    <article class="fi-image" id="fi-image">
        {% block image %}
        <figure>
            <img src="{{ photo.h700.url }}" alt="{{ alttext }}">
        </figure>
        {% block left_arrow %}
        <a id="fi-arrow-left" class="control previous"
            {% if photo.previous %}
                href="{{ photo.previous.get_absolute_url }}"
                hx-get="{{ photo.previous.get_absolute_url }}"
            {% endif %}>
        </a>
        {% endblock %}
        <a id="fi-arrow-right" class="control forward"
            {% if photo.next %}
                href="{{ photo.next.get_absolute_url }}"
                hx-get="{{ photo.next.get_absolute_url }}"
            {% endif %}>
        </a>
        <button id="dl">
            <a href="{{ photo.get_download_page_url }}">
                <img class="meta-dl-icon" src="{% static "assets/images/skyblue/download.svg" %}">
            </a>
        </button>
        <button id="expand">
            <img class="meta-info-icon" src="{% static "assets/images/skyblue/info.svg" %}">
        </button>
        {% endblock %}
        <div id="metadata" class="hidden">
        {% block metadata %}
            {% include "archive/photometadata.html" %}
        {% endblock %}
        </div>

    </article>

    <div class="img-right-space"></div>
    <div class="car-left-space"></div>


    {% block thumbnails %}
    <nav class="fi-timeline" id="fi-timeline">

        <div class="fi-thumbnail-carousel">

            <div class="back-arrows">
                <a id="backward" hx-select="#fi-image"
                    {% if page.has_previous %}
                        hx-get="{{ prev_page.0.get_absolute_url }}"
                        href="{{ prev_page.0.get_absolute_url }}"
                    {% endif %}>
                    <img src="{% static "assets/images/double-back-arrow-black.png" %}" alt="arrows pointing back">
                </a>
            </div>

            <div class="slide-container">
                <ul id="fi-preload-zone"></ul>
                <ul id="fi-thumbnail-carousel-images">
                    {% include "archive/thumbnails.html" %}
                </ul>
            </div>

            <div class="forward-arrows">
                <a id="forward" hx-select="#fi-image"
                    {% if page.has_next %}
                        href="{{ next_page.0.get_absolute_url }}"
                        hx-get="{{ next_page.0.get_absolute_url }}"
                    {% endif %}>
                    <img src="{% static "assets/images/double-back-arrow-black.png" %}" alt="arrows pointing forward">
                </a>
            </div>

        </div>

    </nav>
    {% endblock %}

    <div class="car-right-space"></div>


    <div class="year-ticker">

        {% block year_marker %}
        <div id="active-year-marker" class="active-year-marker" draggable="true" hx-trigger="marker-moved">

            <div class="marker-image" style="background-image: url('{% static "assets/images/skyblue/toggle.svg" %}');">
                <span class="marker-year">{{ photo.year }}</span>
            </div>

        </div>
        {% endblock %}

        {% comment %}
            <div class="year-min">
                <img src="{% static "assets/images/single-back-arrow-black.png" %}" alt="arrow pointing back">
                {{ first_year }}
            </div>
        {% endcomment %}
        <div hx-get="{{ timelinesvg_url }}" hx-trigger="load" hx-swap="outerHTML" hx-target="this" hx-select="svg" hx-select-oob="" hx-push-url="false">
        </div>

        {% comment %}
            <div class="year-max">
                {{ last_year }}
                <img src="{% static "assets/images/single-back-arrow-black.png" %}" alt="arrow pointing forward">
            </div>
        {% endcomment %}

    </div>

</main>
{% endblock %}
